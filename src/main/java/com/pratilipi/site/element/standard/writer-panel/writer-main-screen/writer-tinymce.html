<body>	
	<div class="container" style="height:100%;">
		<div class="header-wrapper">
			<div id="header1" style="background: white; padding-bottom: 10px;">
				<a style="cursor: pointer; margin-top: 10px; margin-right: 10px;" class="pull-left" href="#" data-behaviour="back_button" >
					<div class="sprites-icon left-arrow-icon"></div>
				</a>
				<div class="dropdown" id="toc_container" style="display: inline;">
					<div class="dropdown-toggle" id="table_of_contents_dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" style="display: inline;">
						<button class="btn btn-default white-space-normal" id="toc_button" style="">
							<div class="pull-left sprites-icon list-icon"></div>
							<h4 class="small-screen-hidden" id="book_name_toc" style="margin-top: 10px; margin-bottom: 5px; display: inline;">Title</h4>
							<div class="small-screen-hidden pull-right sprites-icon angle-down-icon"></div>
						</button>
					</div> 
					<ul class="dropdown-menu" aria-labelledby="table_of_contents_dropdown" style="min-width: 230px; margin-top: 13px; border-radius: 0 0 4px 4px;height: auto;overflow-x: hidden;max-height: calc(100vh - 106px);max-height: -o-calc(100vh - 106px);max-height: -webkit-calc(100vh - 106px);max-height: -moz-calc(100vh - 106px);">
						<li style="cursor: pointer;" data-behaviour="edit-title" class="text-center"><strong class="pratilipi-red">${ _strings.writer_edit_title_placeholder }</strong><div class="sprites-icon edit-icon pull-right"></div></li>
						<li role="separator" class="divider"></li>
						<li class="text-center"><strong>${ _strings.writer_table_of_contents }</strong></li>
						<li role="separator" class="divider"></li>
						<li role="separator" class="divider" data-behaviour="chapters_separator_second"></li>
						<li class="text-center" data-behaviour="new_chapter"><a class="show-cursor"><strong class="pratilipi-red"> + ${ _strings.writer_add_new_chapter }</strong></a></li>
					</ul>
				</div>
				<div class="pull-right">
					<button class="pratilipi-red-background-button" style="padding: 6px 12px; margin-right: 0px; border-radius: 4px;" data-toggle="modal" data-target="#publishModal" data-behaviour="publish_button">${ _strings.writer_finish }</button>
					<button class="btn btn-default small-screen-hidden" style="margin: 0 5px 0 10px; font-size: 13px;" data-behaviour="save_button_desktop">${ _strings.writer_save }</button>
					<a href="#" target="_blank" class="btn btn-default small-screen-hidden" style="margin: 0 0px 0 5px; font-size: 13px;" data-behaviour="preview_button_desktop">${ _strings.writer_preview }</a>
					<img 	style="width: 48px; height: 25px; margin-right: -12px;" 
							src="http://0.ptlp.co/resource-all/icon/svg/dots-three-vertical.svg" 
							class="big-screen-hidden mobile_options_container"
							data-container="body" 
							data-toggle="popover"
							data-content="
								<a href='#' style='font-size: x-large;' target='_blank' class='pratilipi-red' data-behaviour='preview_button_mobile'>${ _strings.writer_preview }</a>
								<hr style='margin: 1px 0;'>
								<a data-behaviour='save_button_mobile' style='font-size: x-large;' class='pratilipi-red'>${ _strings.writer_save }</a>" 
							data-html="true" 
							data-placement="bottom">
				</div>
			</div>
		</div>	 

		<#-- panel -->
		<div class="panel panel-default" style="margin-bottom: 5px; margin-top: 12px;">
			<div class="panel-body" style="width: 95%;margin-left: auto;margin-right: auto;text-align: center; padding: 0 0 0 5px;">
						<div class="form-group">
							<input class="form-control horizontal-form-input" autocomplete="off" id="subtitle" style="height: 46px; font-size: 25px; border-bottom: 1px solid #ddd;" placeholder="${ _strings.writer_add_content_title }">
							<#-- editing panel -->

						</div>
					<div id="content-placeholder"></div>
				<div class="clearfix"></div>
			</div>
		</div>
	</div>

	<#-- writer footer -->
	<div id="pagination" style="padding-top: 0.25%; position: fixed; bottom: 0; right: 0; left: 0; background: whitesmoke;">		 	
		<div class="col-lg-4 col-lg-offset-4 col-xs-6 col-xs-offset-3 text-center">
			<form class="inline">
				<a class="show-cursor" data-behaviour="previous-page"><div class="sprites-icon-size-36 chevron-left-icon-36"></div></a>
				<p data-behaviour="page-info" style="display: inline; font-size: 20px; padding: 10px;"><input class="horizontal-form-input" data-behaviour="curr_page" type="text" value="" style="width: 25px;">/1</p>
				<a class="show-cursor" data-behaviour="next-page"><div class="sprites-icon-size-36 chevron-right-icon-36"></div></a>
				<div class="clearfix"></div>
			</form>	
		</div>
		<#-- progress bar -->
		<div class="progress" style="height: 2px; position: absolute; left: 0; right: 0; top: 0%;">
			<div class="progress-bar progress-bar-danger" data-behaviour="progress-line" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
				<span class="sr-only">80% Complete (danger)</span>
			</div>
		</div>
		<div class="sprites-icon-size-16 red-circle-icon-16" data-behaviour="progress-ball" style="left: 0; top: -15%; position: absolute;"></div>
	</div>

	<#-- Modal for title change -->
	<div class="modal fade" id="titleChangelModal" role="dialog" aria-labelledby="titleChange">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
					<h4 class="modal-title" id="titleChange">${ _strings.writer_edit_title_placeholder }</h4>
				</div>
				<form class="form-horizontal">
					<div class="modal-body">
						<div class="form-group has-feedback title-change-input">
							<label>${ _strings.writer_input_title } *</label>
							<input class="form-control horizontal-form-input" id="title-vernacular" placeholder="${ _strings.writer_input_title } *">
						</div>
						<div class="form-group has-feedback title-change-input">
							<label>${ _strings.writer_input_title_en }</label>
							<input class="form-control horizontal-form-input" id="title-english" placeholder="${ _strings.writer_input_title_en }">
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">${ _strings.writer_cancel }</button>
						<button id="title_ok_button" type="submit" class="pratilipi-red-background-modal-button">${ _strings.writer_okay }</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<#-- Modal for leaving without saving changes -->
	<div class="modal fade" id="saveChangesModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title" id="myModalLabel">${ _strings.writer_save }</h4>
	      </div>
	      <div class="modal-body">
	        ${ _strings.writer_save_changes_confirmation }
	      </div>
	      <div class="modal-footer">
	        <button type="button" data-behaviour="cancel" class="btn btn-default" data-dismiss="modal">${ _strings.writer_dont_save }</button>
	        <button type="button" class="pratilipi-red-background-modal-button" data-behaviour="save" class="btn btn-primary">${ _strings.writer_save }</button>
	      </div>
	    </div>
	  </div>
	</div>	

	<#-- Modal for publishing content -->
	<div class="modal fade" id="publishModal" role="dialog" aria-labelledby="publishContent">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
					<h4 class="modal-title" id="publishContent" data-behaviour="publish_book_name">Title</h4>
				</div>
				<form class="form-horizontal" id="publish_form">
					<div class="modal-body modal-form">
						<#--
						<div class="form-group has-feedback">
							<select class="form-control horizontal-form-input" id="category">
								<option selected disabled data-role="default_text">${ _strings.writer_select_category } *</option>
							</select>
						</div>
						-->
						<div class="form-group left-align-content">
							<label class="grey-label pull-left" >${ _strings.writer_add_cover }</label>
							<a class="show-cursor">
								<div class="pull-left image-container" >
									<img class="cover-image" src="http://0.ptlp.co/resource-all/icon/png/default-cover-image.png" alt="#">
									<div class="camera-icon sprites-icon camera-sprite-icon"></div>						
								</div>
							</a>
							<div class="clearfix"></div>
						</div>
						<div class="form-group left-align-content">
							<label class="grey-label">${ _strings.writer_add_summary }</label>
							<textarea id="summary" rows="4" class="form-control grey-background" placeholder="${ _strings.writer_write_here_placeholder }..."></textarea>
						</div>					
					</div>
					<div class="modal-footer text-center">
						<button type="submit" class="pratilipi-red-background-modal-button">${ _strings.writer_publish }</button>
					</div>
				</form>
			</div>
		</div>
		<#-- <form id="uploadPratilipiImage" method="post" enctype="multipart/form-data" action="/api/pratilipi/cover?pratilipiId=${ pratilipiId?c }">
			<input id="uploadPratilipiImageInput" type="file" name="${ pratilipiId?c }" accept="image/*">
		</form> -->
	</div>

	<#-- Modal for URL -->	
	<div class="modal fade" id="urlModal" tabindex="-1" role="dialog" aria-labelledby="pratilipiUrlModal">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
					<h4 class="modal-title" id="pratilipiUrlModal">${ _strings.writer_editor_link }</h4>
				</div>
				<form class="form-horizontal" data-behaviour="url_form">
					<div class="modal-body">
						<div class="form-group" style="margin-top: 10px; margin-bottom: 10px;">
							<div class="col-sm-12">
								<input class="form-control" id="input_url" placeholder="${ _strings.writer_editor_link }">
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">${ _strings.writer_cancel }</button>
						<button id="url_ok_button" type="submit" class="pratilipi-red-background-modal-button">${ _strings.writer_okay }</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<#-- Modal for delete confirmation -->
	<div class="modal fade" id="chapterDeleteModal" tabindex="-1" role="dialog">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
					<h4 class="modal-title">${ _strings.writer_chapter_delete }</h4>
				</div>
				<div class="modal-body">
					<p>${ _strings.writer_chapter_delete_confirmation }</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">${ _strings.writer_cancel }</button>
					<button type="button" id="ok_button" class="pratilipi-red-background-modal-button">${ _strings.writer_okay }</button>
				</div>
			</div>
		</div>
	</div>

	<input type="file" id="upload_images" style="display: none;">
    <div class="word-suggester">
        <div class="word-input" name=""></div>
        <div class="suggestions">
          <div class="suggestion"></div>
        </div>
    </div>	
</body>

<#-- Styles -->
<style>
	<#include "css/toastr.ftl" />
	<#include "css/style.ftl" />
</style>

<#-- Scripts -->
<script>
	<#-- <#include "js/transliteration.ftl" />
	<#include "js/throttle-debounce.ftl">
	<#include "js/toastr.ftl">
	<#include "js/app.ftl">
	<#include "js/mainWriterPanel.ftl">
	<#include "js/tableOfContents.ftl">
	<#include "js/chapter.ftl">
	<#include "js/content.ftl">
	<#include "js/chapterName.ftl">
	<#include "js/editor.ftl">
	<#include "js/pagination.ftl">
	<#include "js/publishModal.ftl">
	<#include "js/imageTools.ftl"> -->
</script>

      <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>

      <script>
        if(screen.width > 480) {
            $.getScript( "https://cdnjs.cloudflare.com/ajax/libs/rangy/1.3.0/rangy-core.min.js", function( data, textStatus, jqxhr ) {
              // console.log( "Load was performed." );
              $.getScript("https://cdnjs.cloudflare.com/ajax/libs/rangy/1.3.0/rangy-selectionsaverestore.min.js", function( data, textStatus, jqxhr ) {
                // console.log( "Load was performed 2  ." );
                $.getScript("resources/js/tinymce-writer/suggester.js", function( data, textStatus, jqxhr ) {
                  console.log( "Load was performed 3  ." );
                  $.getScript("resources/js/tinymce-writer/app.js", function( data, textStatus, jqxhr ) {
                   console.log( "Load was performed 4  ." );
                 });                  
               });                
              });                  
            });
        }
      </script>
      <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/rangy/1.3.0/rangy-core.min.js"></script> -->   
  <script>
  tinymce.init({
    // initialise and auto focus
    selector: '#content-placeholder',
    auto_focus: 'content-placeholder',
    inline: true,
    min_height: 400,
    max_height: 500,
    keep_styles: false,
    block_formats: 'Paragraph=p;',  
    //plugins needed and setting up toolbar
    plugins : ['autoresize autolink lists link image charmap print preview anchor',
    'searchreplace visualblocks code fullscreen',
    'insertdatetime media table paste code'],
    menubar: false,
    statusbar: false,
    toolbar: 'bold italic underline | alignleft aligncenter alignright | blockquote link image | bullist numlist  visualblocks code',
    height: 300,
    language: 'hi_IN',
    language_url : 'https://storage.googleapis.com/devo-pratilipi.appspot.com/hi_IN.js',
    // images_upload_url: '/api/pratilipi/content/image?pratilipiId=5179861627830272',
    // images_upload_base_path: '/some/basepath', 
    link_context_toolbar: true,
    default_link_target:"_blank", 
    allow_unsafe_link_target: false,
    target_list: false,
    link_title: false,
    
    // pasting from other sources
    paste_data_images: true,
     // paste_merge_formats: true, 
    // paste_remove_styles: false,
    // paste_remove_styles_if_webkit: false,
    // paste_strip_class_attributes: true,
    // paste_text_sticky: true,
    // paste_text_sticky_default: true,
    paste_as_text: false,
    paste_auto_cleanup_on_paste : true,
    // paste_enable_default_filters: true,
    // paste_filter_drop: true,
    // paste_word_valid_elements: "i,em,u",
    paste_webkit_styles: "none",
    paste_remove_styles_if_webkit: false,
    paste_text_linebreaktype: "p",

    // paste_retain_style_properties: "color font-size",
    
    // spell check and other options
    browser_spellcheck: false,
    allow_conditional_comments: false,
    allow_html_in_named_anchor: false,
    
    // p on clicking Enter key
    forced_root_block : false,
    force_br_newlines : false,
    force_p_newlines : true,
    remove_trailing_brs: true,
      
    // u instead of text decoration
    formats : {
        bold: {inline : 'b', exact : true},
        italic: {inline : 'i', exact : true},
        underline : {inline : 'u', exact : true},
        blockquote: {block: 'blockquote'},
        img: { block:'img' },

    },
    setup : function(ed) {
      if( screen.width > 480 ) {
        ed.on("keydown", function(e){
            var keycode = e.keycode || e.which;
            var translation = new Translation( keycode );
            if( ( translation.action == 'backspace' || translation.action == 'enter' ) && suggester.getMode()) {
              // console.log(   )
              sendKeyToSuggester(e.which);
              e.preventDefault(); 
            }
        });
      }           
    },
    images_upload_handler: function (blobInfo, success, failure) {
      console.log("coding karni kab seekhoge");
      console.log(blobInfo.blob());
      var fd = new FormData();
      fd.append('data', blobInfo.blob()); 
      $.ajax({
          type:'POST',
          url: '/api/pratilipi/content/image?pratilipiId=5179861627830272&pageNo=1',
          data:fd,
          cache:true,
          contentType: false,
          processData: false,
          success:function(data){
              var parsed_data = jQuery.parseJSON( data );
              var image_name = parsed_data.name;
              var image_url = "/api/pratilipi/content/image?pratilipiId=5179861627830272&name=" + image_name;
              success(image_url);  
          },
          error: function(data){
            failure('HTTP Error: ' + data.status);
            return;
              // $("#my_form input").val("");              
          }
      });    

    },   
    file_browser_callback: function(field_name, url, type, win) {
        if(type=='image') {
         $('#field_name').val(field_name);
         $("#my_form input").click(); 
        }  
    },


    // enforcing rules to editor
    valid_elements : 'p[style],img[src|width|height],blockquote,b,i,u,a[href|target=_blank],br,b/strong,i/em,ol,ul,li',
    extended_valid_elements: 'img[src|width|height],p[style],blockquote,ul,ol,li,a[href|target=_blank]',
    valid_children : 'body[p|img|blockquote|ol|ul],-body[#text],p[b|i|u|a[href]|br],-p[img],blockquote[b|i|u|a[href]|br],ol[li],ul[li],li[b|i|u|a|br]',

    paste_postprocess: function(plugin, args){
      console.log(args.node);
      $(args.node).find("div").replaceWith(function() {
        if( $(this).text().length ) {
          return "<p>" + $(this).html() + '</p>';
        } else {
          return "";
        }
      });
      $(args.node).find("h1,h2,h3,h4,h5,h6").replaceWith(function() {
        if( $(this).text().length ) {
          return "<b>" + $(this).html() + '</b>';
        } else {
          return "";
        }
      });      
    },
    invalid_elements : "div",
    valid_styles: {'p': 'text-align'},


    // image
    image_description: false,
    image_dimensions: false,
  });
 
  </script>
    <script>
        function log() {
            var content = tinyMCE.get('content-placeholder').getContent();
            console.log(content);
            // tinyMCE.get('content-placeholder').setContent(content);
        }
        function uploadOnServer() {
          var field_name = "#" + $('#field_name').val();
          var fd = new FormData();
          var blob = $("#my_form input").get(0).files[0];
          console.log(blob);
          fd.append('data', blob);
          // fd.append('pratilipiId', 5179861627830272 );  
          // fd.append('pageNo', cur_page );  
          console.log(fd.get('data'));
          console.log(blob);    

          $.ajax({
              type:'POST',
              url: '/api/pratilipi/content/image?pratilipiId=5179861627830272&pageNo=1',
              data:fd,
              cache:true,
              contentType: false,
              processData: false,
              success:function(data){
                  var parsed_data = jQuery.parseJSON( data );
                  var image_name = parsed_data.name;
                  var image_url = "/api/pratilipi/content/image?pratilipiId=5179861627830272&name=" + image_name;
                  // if( isMobile() ) {
                  //   image_url += "&width=240";
                  // }
                  $("#my_form input").val("");
                  $(field_name).val( image_url );
              },
              error: function(data){
                  $("#my_form input").val("");              
              }
          });          
        }

</script>     
