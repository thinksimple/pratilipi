<!DOCTYPE html>
<html lang="${ lang }">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="A platform to discover, read and share your favorite stories, poems and books in a language, device and format of your choice.">  
  <title>Pratilipi Summary Page</title>
  <script src="http://0.ptlp.co/resource-all/jquery.knockout.boostrap.js" type="text/javascript"></script>  
</head>
<body>

  <div>
    <h1>Summary Knockout PWA</h1>
  </div>

  <div >
      <p class="title" data-bind="text: title"></p>
      <p class="titleEn" data-bind="text: titleEn"></p>
      <p class="language" data-bind="text: language"><p>
      <p class="state" data-bind="text: state"></p>
      <p class="publish-date" data-bind="text: listingDateMillis"></p>
      <p class="rating" data-bind="text: ratingCount"></p>
      <p class="read-count" data-bind="text: readCount"></p>
  </div>

  <script type="application/javascript">
  $(function(){
    alert("i am ready");
    var reqProperties = ['title', 'titleEn', 'language', 'summary', 'state', 'listingDateMillis', 'ratingCount', 'readCount'];
    var ViewModel = {
        title: ko.observable(),
        titleEn: ko.observable(),
        language: ko.observable(),
        summary: ko.observable(),
        state: ko.observable(),
        listingDateMillis: ko.observable(),
        ratingCount: ko.observable(),
        readCount: ko.observable(),
        pushToViewModel: function( data ){
          var self = this;
          for (var key in data) {
            if (data.hasOwnProperty(key) && reqProperties.includes( key )) {
              self[key]( data[key] );
            }
          }
        }
      };  
      
      ko.applyBindings( ViewModel );
      alert("going to make ajax req");
      $.ajax({
        type: 'get',
        url: '/api/pratilipi?_apiVer=2&pratilipiId=5639631493136384',
        data: { 
            // 'language': "${ language }"
        },
        success: function( response ) {
          var res = jQuery.parseJSON( response );
          alert("ajax succeeded");
          ViewModel.pushToViewModel( res );
        },
        error: function( response ) {
          console.log( response );
          alert("ajax failed");
          console.log( typeof(response) );
        }
    });
  });
  </script>

</body>
</html>
